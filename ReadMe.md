
# DT基盤提供API(API設計書)

> [!note]
>   - [x] ユーザ権限により実行できない機能も存在します。
>   - [x] API認証を実施していない場合、他APIを実行することはできません。
>

> [!important]
>   - [x] APIリクエスト/レスポンスについて \
>       ヘッダー情報/ボディ情報すべての合計サイズが16MByteを超えるとサーバ側でエラーとなるように設定しています。
>
>   - [x] サーバについて \
        サーバも同様に16MByteを超えるとサーバ側でエラーとなるように設定しています。
>

> [!caution]
> - [x] [懸念事項] 検索処理の上限問題 \
>       グラフDBに対して検索処理を実行した結果、取得件数が多いとエラーになる可能性がある。 \
>       以下のような対応策が考えられるが有効ではない為未作成となっています。
>       - 検索処理で返却する出力件数の制限 \
>       ただし、Data(ノード)の型情報に500文字以上設定している項目が存在した場合、出力件数の上限以下でもレスポンスの上限に達しでしまう可能性があるため、有効ではない。
>

> [!warning]
> - [x] [問題] 16Mbyte以上がリクエスト/レスポンスに指定した場合、サーバ側の最大サイズを超えるため、システムが処理を停止します。\
>       現状、16MByteと設定していますがサーバのレスポンスの上限を変更することで返却上限は設定可能ですが、その分クラウドサービスのコストがかかります。レスポンスの上限は実施環境に応じて調整する必要があります。
>
> - [x] [問題] グラフDBのバージョン問題\
>       本APIでは、グラフDBのプロシージャを利用しています。\
>       プロシージャを利用するには、Neo4jの拡張モジュールをインストールする必要があります。\
>       システム更新などでNeo4jのバージョンアップもしくはダウングレードを実行し、Neo4jとモジュールのバージョンが一致していない場合、プロシージャを正常に実行できない可能性があります。\
>       　そのため、グラフDBのバージョンアップ時、プロシージャも別途更新する必要があります。GitHubよりNeo4jのバージョンと一致するモジュールをダウンロードする必須があります。
>

> [!tip]
> グラフDBの機能を確認したい場合、以下のリンク先を参照してください。
> 
> | リンク先情報 | URL |
> | :----------- | :----------- |
> | Neo4j guide | https://neo4j.com/docs/ |
> | APOC Extended user guide | https://neo4j.com/labs/apoc/5/ |
> | APOC Library | https://github.com/neo4j/apoc |
> | APOC Extended Documentation | https://neo4j.com/labs/apoc/5/ |
>
> DT基盤管理コンソールで使用しているNeo4jのバージョンは、5.26.XXです。
>

## 2.1. 【DaCS自動連携内部】CSV変換(データセット)

CSV変換(データセット)に関するAPIの注意事項/問題点を記載する。

- 重要事項
> [!important]
> DaCSユーザ(権限: 管理)のみ実行可能
>

- メモ
> [!note]
> 本章のAPIは、内部処理の為一般公開しない。
>

- 警告
> [!caution]
> DaCSシステムのversion情報が現状(2025/12)より新しい場合、処理が正常に動かない可能性がある。
>

### CSV変換(データセット)

- 問題/懸念点
    > [!warning]
    > - DaCSデータセット/データタイプ/拡張データタイプのインポート機能がない。
    >   - 複合機能は、次章(参照: 3.2. 【DaCS自動連携専用】DaCSデータセット・データ連携)に存在していますが、(作成済のCSVファイルに対して)インポート処理を実行する機能は未作成となっています。
    >     → 設計書を確認したところ、以下のAPIのみ作成しインポート処理のみ実施するAPIの作成は行っていない。そのため、DaCSの内部処理で生成したCSVファイルに対してのインポート処理のみ実施するAPIは存在していない。
    >     - CSVファイル生成API(CSV変換(データセット)API)
    >     - CSVファイル生成＋インポートのAPI(データセット・データ登録・更新)
    >
    >     → インポート処理の拡張機能は内部処理のみ対応しているが、以下の機能は作成していない。
    >     - CSVファイル生成API後にインポートするAPI
    >     - 拡張タイプの入出力が可能なインポート処理を行うAPI
    >  
    > - 上記の為、DaCS用のCSVファイルをインポート/エクスポートするAPIが不足している。
    >     DaCSデータセットのインポート処理(API/画面)
    >     DaCSデータセットのエクスポート処理(API/画面)
    >

***

## 2.2. 【DaCS自動連携内部】CSV変換(データ)

CSV変換(データ)に関するAPIの注意事項/問題点を記載する。

- 重要事項
    > [!important]
    > DaCSユーザ(権限: 管理)のみ実行可能
    >

- メモ
    > [!note]
    > 本章のAPIは、内部処理の為一般公開しない。
    >

- 警告
    > [!caution]
    > DaCSシステムのversion情報が現状(2025/12)より新しい場合、処理が正常に動かない可能性がある。
    >

### CSV変換(データ)

- 問題/懸念点
    > [!warning]
    > - DaCSデータセット/データタイプ/拡張データタイプのインポート機能がない。
    >   - 複合機能は、次章(参照: 3.2. 【DaCS自動連携専用】DaCSデータセット・データ連携)に存在していますが、(作成済のCSVファイルに対して)インポート処理を実行する機能は未作成となっています。
    >     → 設計書を確認したところ、以下のAPIのみ作成しインポート処理のみ実施するAPIの作成は行っていない。そのため、DaCSの内部処理で生成したCSVファイルに対してのインポート処理のみ実施するAPIは存在していない。
    >     - CSVファイル生成API(CSV変換(データセット)API)
    >     - CSVファイル生成＋インポートのAPI(データセット・データ登録・更新)
    >
    >     → インポート処理の拡張機能は内部処理のみ対応しているが、以下の機能は作成していない。
    >     - CSVファイル生成API後にインポートするAPI
    >     - 拡張タイプの入出力が可能なインポート処理を行うAPI
    >
    > - 上記の為、DaCS用のCSVファイルをインポート/エクスポートするAPIが不足している。
    >     DaCSデータのインポート処理(API/画面)
    >     DaCSデータのエクスポート処理(API/画面)
    >

***

## 3.2. 【DaCS自動連携専用】DaCSデータセット・データ連携

DaCSデータセット・データ連携に関するAPIの注意事項/問題点を記載する。

- 重要事項
    > [!important]
    > DaCSユーザ(権限: 管理)のみ実行可能
    >

- 警告
    > [!caution]
    > DaCSシステムのversion情報が現状(2025/12)より新しい場合、処理が正常に動かない可能性がある。
    >

- 問題/懸念点
    > [!warning]
    > - 拡張データタイプの出力機能がない。
    >   - 画面に表示されない為、出力する機能がない。
    >     - DaCSデータセットをDT基盤管理コンソールから出力したとき、拡張データタイプ出力対処に含まれない。
    >     画面から出力可能なCSVファイルは、データセット/データタイプのみとなっており、拡張データタイプはDaCSからの出力のみの為出力対象外となっている。
    >     - 過去設計書から以下検討に含めていない。
    >       - DaCS用のexport機能が存在しない。
    >       - 画面からデータセットの種類を判断し出力する機能がない。
    >       - DaCS専用の型に対する変換処理が存在しない。
    >         DaCS専用の型をDT基盤側の型情報に変換しインポートする機能がない。
    >         グループ型、ファイル型、位置情報に関する型情報は登録できない。
    >       - データセットを分割して登録することは可能だが、データセットを一括でインポートすることはできない。
    >         以下の手順でインポートすることが可能なため、設計の対象外となっている。
    >         - データセットをインポート
    >         - ファイル型データセットのインポート
    >         - データセット関係の登録
    >
    >       - DaCSデータの出力時にDT基盤情報に変換してエクスポートする機能が存在しない。
    >         →　DaCSの型はDaCS自動連携時のみ設定可能な型の為、DT基盤管理コンソールから出力時に型情報を変換することができない。以下の処理で実施が可能となっている。
    >         - 出力したCSVファイルの型情報を手動で変換することでインポートすることは可能となっています。ただし、以下の場合実行できるかは未確認となっています。
    >           - DaCSデータセット情報をエクスポートしたCSVファイルはそのままインポートする。
    >           - DaCS IDに紐づいたまま登録してしまうため、DT基盤管理コンソールからの更新処理ができない。
    >             インポートすることは可能だが、インポート後のデータを修正することはできない。
    >
    >       - DaCS情報とスキーマ情報による差異
    >         スキーマ情報のインポートで型制限を行っているため、DaCS_GROUPの型を設定することでできない。
    >         事前了承でスキーマ情報で登録可能な型情報に位置情報とかは含めていないはず。。。
    >
    > - DaCSデータセット/データタイプ/拡張データタイプのインポート機能がない。
    >   - 複合機能は、次章(参照: 3.2. 【DaCS自動連携専用】DaCSデータセット・データ連携)に存在していますが、(作成済のCSVファイルに対して)インポート処理を実行する機能は未作成となっています。
    >     → 設計書を確認したところ、以下のAPIのみ作成しインポート処理のみ実施するAPIの作成は行っていない。そのため、DaCSの内部処理で生成したCSVファイルに対してのインポート処理のみ実施するAPIは存在していない。
    >     - CSVファイル生成API(CSV変換(データセット)API)
    >     - CSVファイル生成＋インポートのAPI(データセット・データ登録・更新)
    >
    >     → インポート処理の拡張機能は内部処理のみ対応しているが、以下の機能は作成していない。
    >     - CSVファイル生成API後にインポートするAPI
    >     - 拡張タイプの入出力が可能なインポート処理を行うAPI
    >
    > - 上記の為、DaCS用のCSVファイルをインポート/エクスポートするAPIが不足している。
    >     DaCSデータのインポート処理(API/画面)
    >     DaCSデータのエクスポート処理(API/画面)
    >

### データセット・データ登録・更新

### データセット・データ削除

***

## 4.1. 【RDB連携専用】RDB接続連携

RDB接続情報に関するAPIの注意事項/問題点を記載する。

- 参照
    > [!tip]
    > [APOC Extended Documentation](https://neo4j.com/labs/apoc/5/)

### RDB接続情報（登録・更新）

- 重要事項
    > [!important]
    > [Apoc Extended](https://neo4j.com/labs/apoc/5/overview/apoc.dv/apoc.dv.catalog.install/)

- メモ
    > [!note]
    > 現状、RDB(MySQLのみ)の接続に試行回数X回(30秒)までと制限しています。
    > そのため、接続できない場合APIの実行が正常に終了するまで待機することになります。

- 警告
    > [!caution]
    > MySQLのみ本処理は実行できます。
    > MySQL以外ソースは生成しておりません。

- 問題/懸念点
    > [!warning]
    > You need to be very careful about the following.

- 参照
    > [!tip]
    > Tip of the day.

### RDB接続情報（検索）

:::note warn
Todo 検索処理
現状問題と思われますが、登録件数が100件、200件と取得件数が増えた場合、エラーとなります。
:::

:::note warn
Warn 修正案
16MByteまでと制限をかけているため、X件からY件まで取得などの検索制限が必要となってくる。
:::

### RDB接続情報（削除）

### RDB接続情報（接続確認）

### 仮想リソース定義（更新）

### 仮想リソース定義（クリア）

### 仮想リソース実行（デプロイ/アンデプロイ）

### 仮想リソース（検索）

### 仮想リソース定義（更新）

### 仮想リソース定義（クリア）

### 仮想リソース実行（デプロイ/アンデプロイ）

### 仮想リソース（検索）

### RRDB接続情報（登録・更新）




